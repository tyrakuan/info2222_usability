<!DOCTYPE html>
<html>
  <head>
    <title>Chat</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='/styles/chat.css') }}">
  </head>
  <body>

    <div class="header">
      <a href="#">Chat</a>
      <a href="/guide">Course Guide</a>
      <a href="/account">Account</a>
    </div>

    <h1>Welcome to the chat, {{ username }}</h1>
    <p>Your role is: {{ role }}</p>

    <div class="container">
      <h1>Course Chat</h1>
      
      <!-- Message Form -->
      <form id="form" class="message-form">
        <label for="message_input">Message:</label>
        <textarea id="message_input" name="message_input" autocomplete="off" required></textarea><br>
        <button type="submit">Post Message</button>
      </form>

      <div id="messages"></div>
      
      <!-- Message List -->
      <!-- <ul class="message-list" id="messages"> -->
        <!-- messages to be added here -->
      <!-- </ul> -->
    </div>

    <!--Key scripts-->
    <script src="https://cdn.socket.io/3.1.3/socket.io.min.js" integrity="sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh" crossorigin="anonymous"></script>    

    <script type="module">
      window.addEventListener('load', async () => {
        // socket initialisation
        const socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);

        // on message received, add it to the messages list
        socket.on('message', async function(data) {
          var messages = document.getElementById('messages');
          messages.innerHTML += '<p>' + data.username + ': ' + data.message + '</p>';
        });

        document.querySelector('#form').addEventListener('submit', async function(e) {
          // prevents reloading
          e.preventDefault();
      
          // gets message input and sends it out
          var messageInput = document.getElementById('message_input');
          var myMessage = messageInput.value;

          // Emit the 'message' event to the server
          socket.emit('message', {username: '{{ username }}', message: myMessage});

          // Clear form inputs
          messageInput.value = '';
        });
      });
    </script>
  </body>
</html>
